{% extends "base_dashboard.html" %}
{% block content %}
<h2>Analyst Predictions</h2>
<div class="card mb-3">
  <div class="card-body">
    <form class="form-inline" method="get">
      <div class="form-group mr-2 mb-2">
        <label class="mr-2">Analyst</label>
        <input type="text" name="analyst" value="{{ analyst }}" class="form-control" placeholder="Name contains">
      </div>
      <div class="form-group mr-2 mb-2">
        <label class="mr-2">Email</label>
        <input type="text" name="email" value="{{ email }}" class="form-control" placeholder="Email contains">
      </div>
      <div class="form-group mr-2 mb-2">
        <label class="mr-2">Start</label>
        <input type="date" name="start" value="{{ start }}" class="form-control">
      </div>
      <div class="form-group mr-2 mb-2">
        <label class="mr-2">End</label>
        <input type="date" name="end" value="{{ end }}" class="form-control">
      </div>
      <div class="form-group mr-2 mb-2">
        <label class="mr-2">Per page</label>
        <select name="per_page" class="form-control">
          {% for n in [10,20,30,50] %}
            <option value="{{ n }}" {% if per_page==n %}selected{% endif %}>{{ n }}</option>
          {% endfor %}
        </select>
      </div>
      <button class="btn btn-primary mb-2">Filter</button>
      <a href="{{ url_for('admin_predictions') }}" class="btn btn-outline-secondary mb-2 ml-2">Reset</a>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead class="thead-light">
          <tr>
            <th>Created</th>
            <th>Student</th>
            <th>Prediction</th>
            <th class="text-right">Assignment</th>
            <th class="text-right">Test</th>
            <th class="text-right">%</th>
            <th class="text-right">Attendance</th>
            <th>Analyst</th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody>
          {% if items %}
            {% for p in items %}
              <tr>
                <td class="small">{{ p.created_at.strftime('%Y-%m-%d %H:%M') if p.created_at else '' }}</td>
                <td>{{ p.student_name or (p.inputs.student_name if p.inputs) or '-' }}</td>
                <td>
                  <span class="badge {{ 'badge-danger' if p.prediction=='Dropped Out' else 'badge-success' }}">{{ p.prediction }}</span>
                </td>
                <td class="text-right">{{ (p.inputs.assignment_marks if p.inputs) or '-' }}</td>
                <td class="text-right">{{ (p.inputs.test_marks if p.inputs) or '-' }}</td>
                <td class="text-right">{{ (p.inputs.percentage if p.inputs) or '-' }}</td>
                <td class="text-right">{{ (p.inputs.attendance if p.inputs) or '-' }}</td>
                <td>{{ p.analyst or '-' }}</td>
                <td class="small text-muted">{{ p.analyst_email or '' }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="9" class="text-center text-muted">No predictions found.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<nav aria-label="Page navigation" class="mt-3">
  <ul class="pagination">
    {% set prev_page = page - 1 %}
    {% set next_page = page + 1 %}
    <li class="page-item {% if page<=1 %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin_predictions', analyst=analyst, email=email, start=start, end=end, per_page=per_page, page=1) }}" tabindex="-1">First</a>
    </li>
    <li class="page-item {% if page<=1 %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin_predictions', analyst=analyst, email=email, start=start, end=end, per_page=per_page, page=prev_page) }}">Prev</a>
    </li>
    <li class="page-item disabled"><span class="page-link">Page {{ page }} of {{ pages }}</span></li>
    <li class="page-item {% if page>=pages %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin_predictions', analyst=analyst, email=email, start=start, end=end, per_page=per_page, page=next_page) }}">Next</a>
    </li>
    <li class="page-item {% if page>=pages %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('admin_predictions', analyst=analyst, email=email, start=start, end=end, per_page=per_page, page=pages) }}">Last</a>
    </li>
  </ul>
</nav>
{% endblock %}
